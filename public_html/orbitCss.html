<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="jquery-2.1.1.min.js"></script>
        <style>
            body{
                position: absolute;
                top:0;
                left:0;
                bottom: 0;
                right: 0;
            }
            
            .ball{
                position: absolute;
                top: 100px;
                left: 100px;
                width: 20px;
                height: 20px;
                border-radius: 10px;
                background-color: #88F;
            }
        </style>
        <script>
            var friction = 0;
            var grav = 10;
            function Ball($el){
                var x = {
                    v: 0,
                    pos: 100,
                    max: function (){return $(window).width()},
                    css: "left",
                    size: 20
                }
                var y = {
                    v: 0,
                    pos: 100,
                    max: function (){return $(window).height()},
                    css: "top",
                    size: 20
                }
                
                function doAxis(axis, addendum){
                    var max = axis.max();
                    if(axis.pos<=0){
                        axis.pos = 0;
                        axis.v = 0-axis.v;
                    }else if(axis.pos>=(max-axis.size)){
                        axis.pos = max-axis.size;
                        axis.v = 0-axis.v;
                    }else{
                        axis.v+=addendum;
                    }
                    
                    axis.pos += axis.v;
                    $el.css(axis.css, axis.pos + "px");
                }
                var rx, ry, fx, fy, f, theta, xfric, yfric, vtheta;
                var i = 0;
                function correct(num){
                    if(Math.abs(num)<10){
                        num = num < 0 ? -10 : 10;
                    }
                    return num;
                }
                function fall(){
                    if(mouse.x && mouse.y){
                        i++;
                        rx = mouse.x - x.pos - x.size;
                        ry = mouse.y - y.pos - y.size;
                        rx = correct(rx);
                        ry = correct(ry);
                        f = grav/(Math.pow(rx,2) + Math.pow(ry,2));
                        f = Math.min(f, 100);
                        theta = Math.atan2(ry,rx);
                        fx = f * Math.cos(theta);
                        fy = f * Math.sin(theta);
                        vtheta = Math.atan2(y.v, x.v);
                        xfric = friction * Math.cos(vtheta);
                        yfric = friction * Math.sin(vtheta);
                        fx -= xfric;
                        fy -= yfric;
                        doAxis(x, fx);
                        doAxis(y, fy);
                        if(i%100===0){
                            console.log((theta-vtheta)*180/Math.PI);
                        }
                    }
                }
                return {fall: fall};
            }
            var mouse = {}
            function mouseMoveSetup(){
                $("body").on("mousemove", function(e){
                    mouse.x = e.pageX;
                    mouse.y = e.pageY;
                })
            }
            function setGrav(){
                grav = $("#grav").val();
                console.log(grav);
            }
            function setFriction(){
                friction = $("#friction").val() * 0.0001;
                console.log(friction);
            }
            function inputSetup(){
                setGrav();
                setFriction();
                $("body").on("change","#grav", setGrav);
                $("body").on("change","#friction", setFriction);
                
            }
            
            $(function(){
                var ball = new Ball($(".ball").eq(0));
                mouseMoveSetup();
                inputSetup();
                var int = window.setInterval(ball.fall, 1);
            })
            
            
        </script>
    </head>
    <body>
        <div data-v="0" class="ball"></div>
        <label for="grav">Strength of gravity</label><input type="number" value="10" id="grav">
        <label for="friction">Strength of friction</label><input type="number" value="0" id="friction">
    </body>
</html>
